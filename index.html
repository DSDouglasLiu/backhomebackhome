<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>車流人流退場情報（每頁獨立更新）</title>
<style>
  :root { --blue:#2f6de1; --text:#0e1116; --muted:#6b7280; --bd:#e5e7eb; }
  body{font-family:-apple-system,BlinkMacSystemFont,"Microsoft JhengHei",Roboto,Arial,sans-serif;margin:0;background:#f5f7fa;color:var(--text)}
  header{display:flex;align-items:center;gap:12px;padding:18px 20px;border-bottom:1px solid var(--bd);background:#fff;position:sticky;top:0;z-index:10}
  .tabs{display:flex;gap:12px;margin-right:auto;flex-wrap:wrap}
  .tab{padding:12px 20px;border:2px solid var(--blue);border-radius:14px;background:#fff;color:var(--blue);font-weight:700;cursor:pointer;user-select:none}
  .tab.active{background:var(--blue);color:#fff}
  .right-refresh{display:flex;align-items:center;gap:10px;margin-left:auto;flex-wrap:wrap}
  .clock{font-size:26px;font-weight:800;letter-spacing:.5px}
  .chip{padding:10px 18px;border:2px solid var(--blue);border-radius:14px;background:#fff;color:var(--blue);font-weight:700;cursor:pointer;user-select:none;min-width:64px;text-align:center}
  .chip.active{background:var(--blue);color:#fff}
  main{padding:18px}
  .pane{display:none}
  .pane.active{display:block}
  .card{background:#fff;border:1px solid var(--bd);border-radius:14px;padding:14px;box-shadow:0 .5px 0 rgba(0,0,0,.02);margin-bottom:14px}
  .small{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <header>
    <nav class="tabs">
      <div class="tab active" data-pane="punch">登錄</div>
      <div class="tab" data-pane="dashboard">整體情報</div>
      <div class="tab" data-pane="single">個別情報</div>
    </nav>
    <div class="right-refresh" id="refreshBar">
      <div class="clock" id="clock">--:--:--</div>
      <button class="chip" data-period="300">5分</button>
      <button class="chip" data-period="120">2分</button>
      <button class="chip" data-period="60">60秒</button>
      <button class="chip" data-period="30">30秒</button>
      <button class="chip" id="now">立即更新</button>
    </div>
  </header>

  <main>
    <section id="pane-punch" class="pane active">
      <div class="card"><h3>登錄頁</h3><div class="small" id="log-punch">尚未更新</div></div>
    </section>

    <section id="pane-dashboard" class="pane">
      <div class="card"><h3>整體情報</h3><div class="small" id="log-dashboard">尚未更新</div></div>
    </section>

    <section id="pane-single" class="pane">
      <div class="card"><h3>個別情報</h3><div class="small" id="log-single">尚未更新</div></div>
    </section>
  </main>

<script>
/* ================== 每頁獨立更新狀態 ================== */
const Pages = {
  punch:     { period:0, left:0, timer:null, enabled:false, log:'#log-punch',     refresh: refreshPunch },
  dashboard: { period:0, left:0, timer:null, enabled:false, log:'#log-dashboard', refresh: refreshDashboard },
  single:    { period:0, left:0, timer:null, enabled:false, log:'#log-single',    refresh: refreshSingle },
};

/* ===== 你現有專案的實際「更新動作」請改在這三個函式 ===== */
function refreshPunch()     { stampTo(Pages.punch.log,      '登錄頁');      /* 例：reloadSheet(); */ }
function refreshDashboard() { stampTo(Pages.dashboard.log,  '整體情報');    /* 例：buildDashboard(false); */ }
function refreshSingle()    { stampTo(Pages.single.log,     '個別情報');    /* 例：loadSingleData(); */ }

/* 小工具：寫入時間戳 */
function stampTo(sel, label){
  const el = document.querySelector(sel);
  const d = new Date(); const p = n => String(n).padStart(2,'0');
  el.textContent = `${label}已更新：${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;
}

/* ================== 共同 UI：時鐘與按鈕 ================== */
const clockEl = document.getElementById('clock');
setInterval(()=>{
  const d=new Date(); const p=n=>String(n).padStart(2,'0');
  clockEl.textContent = `${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;
}, 500);

function currentPane(){ return document.querySelector('.pane.active').id.replace('pane-',''); }

document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click', ()=>{
    if (t.classList.contains('active')) return;
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const target = t.dataset.pane;
    document.querySelectorAll('.pane').forEach(p=>p.classList.remove('active'));
    document.getElementById(`pane-${target}`).classList.add('active');
    // 切頁時，同步高亮該頁目前的 period
    highlightFor(target);
  });
});

/* 頻率按鈕：針對「目前頁」設定並啟動計時器 */
document.querySelectorAll('.chip[data-period]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const page = currentPane();
    const sec  = Number(btn.dataset.period);
    setPagePeriod(page, sec);
    startTimer(page);
    highlightFor(page);
    // 多數情境會希望設定後馬上刷新一次
    Pages[page].refresh();
  });
});

/* 立即更新：只更新當前頁 */
document.getElementById('now').addEventListener('click', ()=>{
  Pages[currentPane()].refresh();
});

/* ================== 每頁計時器邏輯 ================== */
function setPagePeriod(page, seconds){
  const st = Pages[page];
  st.period  = seconds;
  st.left    = seconds;
  st.enabled = seconds > 0;
}

function startTimer(page){
  const st = Pages[page];
  if (st.timer) clearInterval(st.timer);
  if (!st.enabled || st.period<=0) return;
  st.left = st.period;
  st.timer = setInterval(()=>{
    st.left--;
    if (st.left<=0){
      st.left = st.period;
      st.refresh();
    }
  }, 1000);
}

function stopTimer(page){
  const st = Pages[page];
  if (st.timer){ clearInterval(st.timer); st.timer=null; }
}

/* 切頁時同步上方按鈕的 active 樣式（只做視覺，不改動其他頁設定） */
function highlightFor(page){
  document.querySelectorAll('.chip[data-period]').forEach(c=>c.classList.remove('active'));
  const st = Pages[page];
  if (st.enabled){
    const btn = document.querySelector(`.chip[data-period="${st.period}"]`);
    if (btn) btn.classList.add('active');
  }
}

/* 初始：預設全部不自動刷新，只同步一次按鈕高亮 */
highlightFor('punch');
</script>
</body>
</html>
